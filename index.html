<!--
INSTRUCTIONS FOR DAKBOARD SETUP:
1. Download this HTML file to your computer.
2. Go to https://app.netlify.com/drop (a free hosting tool).
3. Drag and drop this HTML file into Netlify Drop. It will give you a secure HTTPS link.
4. Copy that link.
5. In your DAKboard account, go to Custom Screen ‚Üí Add Block ‚Üí iFrame.
6. Paste that link in the iFrame URL field.
7. Save your screen, and you‚Äôll see your Weekly Family Dinner Planner displayed.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Family Dinner Planner</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    html, body { font-family: 'Oswald', sans-serif; margin: 0; padding: 0; width: 100%; height: 100%; background: transparent; color: #333333; display: flex; justify-content: center; }
    main { display: flex; flex-direction: column; padding: 1rem; width: 100%; max-width: 1080px; height: 100%; box-sizing: border-box; }
    .controls { display: flex; justify-content: flex-start; flex-wrap: wrap; margin-bottom: 1rem; gap: .5rem; }
    button { background: #3b82f6; color: white; border: none; border-radius: 8px; padding: 0.5rem 1rem; cursor: pointer; font-family: 'Oswald', sans-serif; }
    button:hover { background: #2563eb; }
    #mealContainer { display: flex; gap: 0.5rem; flex-grow: 1; overflow-x: auto; align-items: stretch; }
    .meal-day { background: rgba(255,255,255,0.1); border: 1px solid #888888; border-radius: 10px; padding: 0.4rem 0.5rem 0.3rem 0.5rem; flex: 1 1 calc(14% - 0.5rem); min-width: 150px; color: #333333; box-sizing: border-box; font-size: 1.05rem; display: flex; flex-direction: column; justify-content: flex-start; height: 100%; }
    .meal-day h3 {$1 font-size: 1.15rem;}
    .meal-day p, .meal-day .meal-name { color: #333333; margin: 0; text-align: center; }
    .rating { margin-top: 0.15rem; margin-bottom: 0; display: flex; justify-content: center; align-items: center; gap: 6px; }
    .thumb {$1 font-size: 1.2rem;}
    .thumb.up.active { color: #16a34a; filter: none; }
    .thumb.down.active { color: #dc2626; filter: none; }
    .replace-btn {$1 font-size: 1.3rem;
    .replace-btn:hover { color: #f97316; }
  .thumb:hover { opacity: 0.6; filter: grayscale(60%); }
.replace-btn { transition: color 0.25s ease, opacity 0.25s ease; }
.replace-btn:hover { opacity: 0.7; }
</style>
</head>
<body>
  <main>
    <div class="controls">
      <button id="newPlan">Generate New Plan</button>
      <button id="addItem" style="background:#10b981;">Add Item</button>
    </div>
    <div id="mealContainer"></div>
  </main>

  <script>
    // -----------------------------
    // Data
    // -----------------------------
    const baseDinners = [
      'Beef Stroganoff over Egg Noodles', 'Chicken Marsala with Garlic Mashed Potatoes',
      'Pork Tenderloin with Roasted Vegetables', 'Stuffed Peppers with Ground Turkey',
      'Teriyaki Chicken with Stir-Fried Veggies', 'Homemade Lasagna', 'Balsamic Glazed Chicken with Quinoa',
      'Honey Garlic Pork Chops with Rice Pilaf', 'Chicken Fajitas with Peppers and Onions', 'BBQ Ribs with Coleslaw',
      'Baked Ziti with Italian Sausage', 'Grilled Steak with Roasted Potatoes', 'Creamy Tuscan Chicken Pasta',
      'Crockpot Pot Roast with Carrots and Potatoes', 'Taco Bowls with Rice and Black Beans',
      'Buffalo Chicken Wraps with Celery and Ranch', 'Baked Chicken Parmesan',
      'Stuffed Shells with Spinach and Ricotta', 'Honey Mustard Chicken with Roasted Sweet Potatoes', 'Beef and Broccoli Stir Fry',
      'BBQ Pulled Pork Sandwiches', 'Chicken Alfredo with Broccoli', 'Greek Chicken with Lemon Rice and Cucumber Salad',
      'Beef Enchiladas with Spanish Rice', 'Chicken Burrito Bowls', 'Cajun Chicken Pasta',
      'Meatloaf with Mashed Potatoes and Green Beans', 'Grilled Chicken Caesar Wraps', 'Margherita Flatbread Pizza',
      'Crockpot Chili with Cornbread', 'Baked BBQ Chicken Thighs with Rice', 'Stir Fry Noodle Bowls with Chicken',
      'Beef Tacos with Fresh Salsa', 'Sheet Pan Chicken and Veggies', 'Chicken Pot Pie with Flaky Crust',
      'Sausage and Peppers over Rice', 'Spaghetti Carbonara'
    ];

    function loadCustomDinners(){
      try { return JSON.parse(localStorage.getItem('customDinners')) || []; } catch(e){ return []; }
    }
    function saveCustomDinners(list){ localStorage.setItem('customDinners', JSON.stringify(list)); }
    function getDinners(){ return baseDinners.concat(loadCustomDinners()); }

    const mealContainer = document.getElementById('mealContainer');
    let favorites = JSON.parse(localStorage.getItem('favorites')) || {};

    // -----------------------------
    // Helpers
    // -----------------------------
    function getRandomDinner(exclude = null) {
      const all = getDinners();
      if (all.length === 0) return '';

      // Weight toward liked, away from disliked
      const liked = all.filter(x => favorites[x] === 'up');
      const neutral = all.filter(x => !favorites[x]);
      const weighted = [...liked, ...neutral, ...neutral, ...liked];
      const pool = (weighted.length > 0) ? weighted : all;

      let choice;
      let safety = 0;
      do {
        choice = pool[Math.floor(Math.random() * pool.length)];
        safety++;
      } while (choice === exclude && safety < 15);

      return choice || all[0];
    }

    function generatePlan() {
      const plan = [];
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      for (let i = 0; i < 7; i++) plan.push({ day: days[i], dinner: getRandomDinner() });
      return plan;
    }

    function saveFavorites() { localStorage.setItem('favorites', JSON.stringify(favorites)); }

    function renderPlan(plan) {
      mealContainer.innerHTML = '';
      plan.forEach((day) => {
        const div = document.createElement('div');
        div.className = 'meal-day';

        const upActive = favorites[day.dinner] === 'up' ? 'active' : '';
        const downActive = favorites[day.dinner] === 'down' ? 'active' : '';

        div.innerHTML = `
          <h3>${day.day}</h3>
          <p class="meal-name">${day.dinner}</p>
          <div class="rating">
            <span class="thumb up ${upActive}">üëç</span>
            <span class="thumb down ${downActive}">üëé</span>
            <button class="replace-btn" title="Replace">‚Üª</button>
          </div>
        `;

        div.querySelector('.thumb.up').addEventListener('click', () => {
          favorites[day.dinner] = favorites[day.dinner] === 'up' ? null : 'up';
          saveFavorites();
          renderPlan(plan);
        });
        div.querySelector('.thumb.down').addEventListener('click', () => {
          favorites[day.dinner] = favorites[day.dinner] === 'down' ? null : 'down';
          saveFavorites();
          renderPlan(plan);
        });
        div.querySelector('.replace-btn').addEventListener('click', () => {
          day.dinner = getRandomDinner(day.dinner);
          localStorage.setItem('familyDinnerPlan', JSON.stringify(plan));
          renderPlan(plan);
        });

        mealContainer.appendChild(div);
      });
    }

    function loadPlan() {
      const stored = localStorage.getItem('familyDinnerPlan');
      if (stored) renderPlan(JSON.parse(stored));
      else { const newPlan = generatePlan(); localStorage.setItem('familyDinnerPlan', JSON.stringify(newPlan)); renderPlan(newPlan); }
    }

    document.getElementById('newPlan').addEventListener('click', () => {
      const newPlan = generatePlan();
      localStorage.setItem('familyDinnerPlan', JSON.stringify(newPlan));
      renderPlan(newPlan);
    });

    document.getElementById('addItem').addEventListener('click', () => {
      const name = (prompt('Add a dinner item (e.g., "Chicken Piccata")') || '').trim();
      if (!name) return;
      const custom = loadCustomDinners();
      const exists = baseDinners.concat(custom).some(x => x.toLowerCase() === name.toLowerCase());
      if (exists) { alert('That item already exists.'); return; }
      custom.push(name);
      saveCustomDinners(custom);
      alert('Added! New suggestions will include it.');
    });

    // -----------------------------
    // Minimal Test Cases (console)
    // -----------------------------
    ;(function runTests(){
      try {
        console.assert(typeof getRandomDinner() === 'string', 'getRandomDinner should return a string');
        const ex = baseDinners[0];
        let tries = 20, ok = true;
        while (tries--) { if (getRandomDinner(ex) === ex) ok = false; }
        console.assert(ok, 'getRandomDinner(exclude) should avoid excluded item (most tries)');
        const before = loadCustomDinners().length;
        saveCustomDinners(['Test Item']);
        console.assert(loadCustomDinners().length >= before, 'custom dinners should persist');
        // cleanup test artifact (non-destructive)
        const current = loadCustomDinners().filter(x => x !== 'Test Item');
        saveCustomDinners(current);
        console.log('Meal Planner tests passed');
      } catch(e){ console.warn('Meal Planner tests encountered an issue:', e); }
    })();

    // Kickoff
    loadPlan();
  </script>
</body>
</html>
